<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservas Balandra - Parque Natural</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- Agrega la librería jsPDF en el <head> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary: #2c6e49;
            --secondary: #4c956c;
            --accent: #fefee3;
            --light: #fefee3;
            --dark: #1d3557;
            --danger: #e63946;
            --success: #2a9d8f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* NAVBAR más compacto y responsivo */
        header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 0.3rem 0;
            box-shadow: 0 4px 16px rgba(44, 110, 73, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background 0.4s;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.2rem;
        }
        
        .logo h1 {
            font-size: 1.05rem;
            font-weight: 800;
            letter-spacing: 1px;
            color: #fff;
            text-shadow: 0 2px 8px #2c6e4922;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 10px;
            background: rgba(255,255,255,0.07);
            border-radius: 30px;
            padding: 2px 6px;
            box-shadow: 0 2px 8px #0001;
            margin: 0;
        }
        
        nav a {
            color: #fff;
            text-decoration: none;
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 20px;
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
            letter-spacing: 0.5px;
            position: relative;
            font-size: 0.98rem;
        }
        
        nav a:hover, nav a:focus {
            background: var(--accent);
            color: var(--primary);
            box-shadow: 0 2px 8px #2c6e4922;
        }
        nav a.active, nav a[aria-current="page"] {
            background: var(--accent);
            color: var(--primary);
            cursor: default;
            pointer-events: none;
            box-shadow: 0 2px 8px #2c6e4922;
        }
        nav a.disabled, nav a[aria-disabled="true"] {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .hero {
            background: url('https://cdn.sanity.io/images/esqfj3od/production/adfbd4a5bc9a168f707d15fb22a66d6cf3c19001-1080x720.webp?w=3840&q=65&fit=clip&auto=format') no-repeat center center/cover;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            position: relative;
        }
        
        .hero::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .hero-content {
            z-index: 1;
            max-width: 800px;
            padding: 0 20px;
        }
        
        .hero h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }
        
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid white;
        }
        
        .btn-outline:hover {
            background: white;
            color: var(--primary);
        }
        
        .section-title {
            text-align: center;
            margin: 3rem 0 2rem;
            color: var(--dark);
            font-size: 2rem;
        }
        
        .reservation-system {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 1.2rem;
            margin: 1.2rem auto;
            max-width: 800px;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-bottom: 2rem;
        }
        
        .calendar-header {
            grid-column: 1 / -1;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calendar-day {
            text-align: center;
            padding: 7px;
            border-radius: 5px;
            background: #f8f9fa;
            font-weight: 500;
            font-size: 0.98rem;
        }
        
        .calendar-date {
            text-align: center;
            padding: 7px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.98rem;
        }
        
        .calendar-date:hover {
            background: var(--secondary);
            color: white;
        }
        
        .calendar-date.selected {
            background: var(--primary);
            color: white;
        }
        
        .calendar-date.disabled {
            background: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
        }
        
        .time-slots {
            display: flex;
            gap: 10px;
            flex-direction: row;
            margin-bottom: 2rem;
        }
        
        .time-slot {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.98rem;
        }
        
        .time-slot:hover {
            background: var(--secondary);
            color: white;
        }
        
        .time-slot.selected {
            background: var(--primary);
            color: white;
        }
        
        .time-slot.disabled {
            background: #e9ecef;
            color: #adb5bd;
            cursor: not-allowed;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 9px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.98rem;
        }
        
        .availability {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }
        
        .availability.high {
            background: #d1e7dd;
            color: #0f5132;
        }
        
        .availability.medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .availability.low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .confirmation {
            display: none;
            text-align: center;
            padding: 1.2rem;
            background: #e9f5ef;
            border-radius: 10px;
            margin-top: 1.2rem;
        }
        
        .confirmation h3 {
            color: var(--success);
            margin-bottom: 1rem;
        }
        
        #qrcode {
            margin: 1rem auto;
            display: flex;
            justify-content: center;
        }
        
        footer {
            background: linear-gradient(90deg, #1d3557 0%, #274472 100%);
            color: #fff;
            padding: 2.5rem 0 0.5rem 0;
            margin-top: 4rem;
            box-shadow: 0 -4px 16px rgba(44, 110, 73, 0.10);
            position: relative;
            overflow: hidden;
        }
        
        footer::before {
            content: '';
            position: absolute;
            top: -60px;
            left: -60px;
            width: 180px;
            height: 180px;
            background: rgba(254, 254, 227, 0.08);
            border-radius: 50%;
            z-index: 0;
            filter: blur(2px);
        }
        footer::after {
            content: '';
            position: absolute;
            bottom: -60px;
            right: -60px;
            width: 180px;
            height: 180px;
            background: rgba(42, 157, 143, 0.10);
            border-radius: 50%;
            z-index: 0;
            filter: blur(2px);
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 1.5rem;
            padding: 0 1rem;
            transition: background 0.3s;
            border-radius: 12px;
        }
        
        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.25rem;
            color: #fefee3;
            text-shadow: 0 2px 8px #1d355755;
            letter-spacing: 0.5px;
        }
        
        .footer-section p, .footer-section i {
            color: #fefee3;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            transition: color 0.3s;
        }
        
        .footer-section i {
            margin-right: 8px;
            color: var(--success);
        }
        
        .footer-section:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.12);
            margin-top: 1.5rem;
            color: #fefee3;
            font-size: 1rem;
            letter-spacing: 0.5px;
            z-index: 1;
            position: relative;
        }
        
        /* Nuevos estilos para el wizard de pasos */
        .steps {
            display: flex;
            justify-content: center;
            margin-bottom: 1.2rem;
            gap: 10px;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #adb5bd;
            font-weight: 500;
        }
        .step.active {
            color: var(--primary);
        }
        .step .circle {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
            font-weight: bold;
            font-size: 1rem;
        }
        .step.active .circle {
            background: var(--primary);
            color: white;
        }
        .step.completed .circle {
            background: var(--success);
            color: white;
        }
        .step.completed {
            color: var(--success);
        }
        .step-label {
            font-size: 0.9rem;
        }
        .step-separator {
            width: 20px;
            height: 2px;
            background: #e9ecef;
            align-self: center;
            margin: 0 2px;
        }
        .step.active ~ .step-separator,
        .step.completed ~ .step-separator {
            background: var(--primary);
        }
        .step.completed ~ .step-separator {
            background: var(--success);
        }
        .step-separator:last-child {
            display: none;
        }
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
        
        @media (max-width: 900px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }
            nav ul {
                gap: 10px;
                padding: 4px 0;
            }
            .logo h1 {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 0 6px;
            }
            .header-content {
                flex-direction: column;
                align-items: stretch;
                gap: 2px;
            }
            .logo {
                gap: 6px;
            }
            .logo h1 {
                font-size: 0.95rem;
            }
            nav ul {
                flex-direction: column;
                align-items: stretch;
                gap: 0;
                background: transparent;
                box-shadow: none;
                padding: 0;
            }
            nav li {
                width: 100%;
            }
            nav a {
                display: block;
                width: 100%;
                text-align: left;
                padding: 7px 0 7px 10px;
                border-radius: 0;
                font-size: 0.97rem;
            }
            .reservation-system {
                padding: 0.5rem;
                margin: 0.5rem 0;
                max-width: 100%;
            }
            .calendar {
                gap: 2px;
            }
            .calendar-day, .calendar-date {
                padding: 4px 0;
                font-size: 0.92rem;
            }
            .time-slots {
                flex-direction: column;
                gap: 6px;
            }
            .time-slot {
                padding: 7px;
                font-size: 0.95rem;
            }
            .form-group {
                margin-bottom: 0.8rem;
            }
            .form-group input,
            .form-group select {
                padding: 7px;
                font-size: 0.95rem;
            }
            .steps {
                gap: 4px;
                margin-bottom: 0.7rem;
            }
            .step .circle {
                width: 20px;
                height: 20px;
                font-size: 0.85rem;
            }
            .step-label {
                font-size: 0.8rem;
            }
            .step-separator {
                width: 10px;
                height: 2px;
                margin: 0 1px;
            }
            .confirmation {
                padding: 0.7rem;
                margin-top: 0.7rem;
                font-size: 0.97rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-tree"></i>
                <h1>Reservas Balandra</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="active" aria-current="page">Inicio</a></li>
                    <li><a href="#" class="disabled" tabindex="-1" aria-disabled="true">Reservar</a></li>
                    <li><a href="#" class="disabled" tabindex="-1" aria-disabled="true">Información</a></li>
                    <li><a href="#" class="disabled" tabindex="-1" aria-disabled="true">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h2>Descubre la belleza natural de Balandra</h2>
            <p>Reserva tu visita y garantiza tu acceso a este paraíso natural</p>
            <a href="#reservation" class="btn btn-outline">Reservar Ahora</a>
        </div>
    </section>

    <div class="container">
        <h2 class="section-title">Sistema de Reservas</h2>
        
        <div class="reservation-system" id="reservation">
            <!-- Indicador de pasos tipo wizard -->
            <div class="steps" id="steps-indicator">
                <div class="step active" data-step="1">
                    <div class="circle">1</div>
                    <div class="step-label">Fecha</div>
                </div>
                <div class="step-separator"></div>
                <div class="step" data-step="2">
                    <div class="circle">2</div>
                    <div class="step-label">Turno</div>
                </div>
                <div class="step-separator"></div>
                <div class="step" data-step="3">
                    <div class="circle">3</div>
                    <div class="step-label">Datos</div>
                </div>
                <div class="step-separator"></div>
                <div class="step" data-step="4">
                    <div class="circle"><i class="fas fa-check"></i></div>
                    <div class="step-label">Confirmar</div>
                </div>
            </div>
            <!-- Paso 1: Selección de fecha -->
            <div class="step-content active" data-step="1">
                <div class="calendar">
                    <div class="calendar-header">
                        <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                        <h3 id="current-month">Septiembre 2023</h3>
                        <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <!-- Cambia el orden de los días para que inicie en Lunes -->
                    <div class="calendar-day">Lun</div>
                    <div class="calendar-day">Mar</div>
                    <div class="calendar-day">Mié</div>
                    <div class="calendar-day">Jue</div>
                    <div class="calendar-day">Vie</div>
                    <div class="calendar-day">Sáb</div>
                    <div class="calendar-day">Dom</div>
                    <div id="calendar-dates"></div>
                </div>
                <button class="btn" id="to-step-2" style="margin: 0 auto; display: block;">Siguiente</button>
            </div>
            <!-- Paso 2: Selección de turno -->
            <div class="step-content" data-step="2">
                <div class="availability high">
                    <i class="fas fa-check-circle"></i> Disponibilidad alta: Más de 300 cupos disponibles
                </div>
                <h3>Selecciona un turno:</h3>
                <div class="time-slots">
                    <div class="time-slot" data-time="morning">
                        <h4>Turno Mañana</h4>
                        <p>8:00 AM - 12:00 PM</p>
                        <p>Disponibles: <span id="morning-slots">450</span></p>
                    </div>
                    <div class="time-slot" data-time="afternoon">
                        <h4>Turno Tarde</h4>
                        <p>1:00 PM - 5:00 PM</p>
                        <p>Disponibles: <span id="afternoon-slots">450</span></p>
                    </div>
                </div>
                <button class="btn" id="to-step-1" style="margin-right: 10px;">Anterior</button>
                <button class="btn" id="to-step-3">Siguiente</button>
            </div>
            <!-- Paso 3: Datos personales -->
            <div class="step-content" data-step="3">
                <form id="reservation-form">
                    <div class="form-group">
                        <label for="name">Nombre completo</label>
                        <input type="text" id="name" placeholder="Ingresa tu nombre completo" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Correo electrónico</label>
                        <input type="email" id="email" placeholder="Ingresa tu correo electrónico" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Teléfono de contacto</label>
                        <input type="tel" id="phone" placeholder="Ingresa tu número de teléfono" required>
                    </div>
                    <div class="form-group">
                        <label for="visitors">Número de visitantes</label>
                        <select id="visitors" required>
                            <option value="">Selecciona cantidad</option>
                            <option value="1">1 persona</option>
                            <option value="2">2 personas</option>
                            <option value="3">3 personas</option>
                            <option value="4">4 personas</option>
                            <option value="5">5 personas</option>
                            <option value="6">6 personas</option>
                        </select>
                    </div>
                    <!-- En el formulario de datos personales, agrega la selección de horas -->
                    <div class="form-group">
                        <label for="stay-hours">¿Cuántas horas deseas estar?</label>
                        <select id="stay-hours" required>
                            <option value="">Selecciona horas</option>
                            <option value="1">1 hora</option>
                            <option value="2">2 horas</option>
                            <option value="3">3 horas</option>
                            <option value="4">4 horas</option>
                        </select>
                    </div>
                    <button class="btn" id="to-step-2" type="button" style="margin-right: 10px;">Anterior</button>
                    <button type="submit" class="btn">Confirmar Reserva</button>
                </form>
            </div>
            <!-- Paso 4: Confirmación -->
            <div class="confirmation step-content" data-step="4" id="confirmation">
                <h3><i class="fas fa-check-circle"></i> ¡Reserva Confirmada!</h3>
                <p>Hemos enviado los detalles de tu reserva a tu correo electrónico.</p>
                <p>Fecha: <span id="conf-date"></span></p>
                <p>Turno: <span id="conf-time"></span></p>
                <p>Visitantes: <span id="conf-visitors"></span></p>
                <p>Tiempo de estancia: <span id="conf-hours"></span></p>
                <p>Código de reserva: <span id="conf-code"></span></p>
                <div id="qrcode" style="margin: 1rem auto; display: flex; justify-content: center;">
                    <!-- Aquí se mostrará el QR ficticio -->
                </div>
                <p>Presenta este código QR en la entrada del parque.</p>
                <!-- Botón para descargar PDF -->
                <button class="btn" id="download-pdf" style="margin-bottom: 1rem;">Descargar PDF</button>
                <button class="btn" id="new-reservation">Nueva Reserva</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container footer-content">
            <div class="footer-section">
                <h3>Contacto</h3>
                <p><i class="fas fa-map-marker-alt"></i> Balandra, Baja California Sur, México</p>
                <p><i class="fas fa-phone"></i> +52 612 123 4567</p>
                <p><i class="fas fa-envelope"></i> info@reservasbalandra.com</p>
            </div>
            
            <div class="footer-section">
                <h3>Horarios de Atención</h3>
                <p>Lunes a Domingo</p>
                <p>8:00 AM - 5:00 PM</p>
                <p>Turnos de 4 horas</p>
            </div>
            
            <div class="footer-section">
                <h3>Políticas</h3>
                <p>Máximo 6 personas por reserva</p>
                <p>Cancelación con 24h de anticipación</p>
                <p>Llega 30 min antes de tu turno</p>
            </div>
        </div>
        
        <div class="container copyright">
            <p>&copy; 2023 Reservas Balandra - Todos los derechos reservados</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variables globales
            let selectedDate = null;
            let selectedTime = null;
            let morningSlots = 450;
            let afternoonSlots = 450;

            // --- NUEVO: Wizard de pasos ---
            function goToStep(step) {
                // Actualiza los pasos visuales
                document.querySelectorAll('.step').forEach((el, idx) => {
                    el.classList.remove('active', 'completed');
                    if (idx < step - 1) el.classList.add('completed');
                    else if (idx === step - 1) el.classList.add('active');
                });
                // Muestra el contenido del paso actual
                document.querySelectorAll('.step-content').forEach(el => {
                    el.classList.remove('active');
                    if (parseInt(el.getAttribute('data-step')) === step) el.classList.add('active');
                });
                // Oculta confirmación si no es el paso 4
                if (step !== 4) document.getElementById('confirmation').style.display = 'none';
            }

            // Botones de navegación
            document.getElementById('reservation').addEventListener('click', function(e) {
                if (e.target.id === 'to-step-2') goToStep(2);
                if (e.target.id === 'to-step-1') goToStep(1);
                if (e.target.id === 'to-step-3') {
                    if (!selectedTime) { alert('Selecciona un turno'); return; }
                    goToStep(3);
                }
                if (e.target.id === 'new-reservation') {
                    // Reiniciar todo
                    document.getElementById('reservation-form').reset();
                    selectedDate = null;
                    selectedTime = null;
                    document.querySelectorAll('.calendar-date.selected').forEach(el => el.classList.remove('selected'));
                    document.querySelectorAll('.time-slot.selected').forEach(el => el.classList.remove('selected'));
                    goToStep(1);
                }
            });

            // Paso 1: Selección de fecha
            function initCalendar() {
                const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
                const currentDate = new Date();
                const currentMonth = currentDate.getMonth();
                const currentYear = currentDate.getFullYear();
                
                document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;
                
                // Generar días del calendario
                generateCalendar(currentMonth, currentYear);
                
                // Event listeners para cambiar de mes
                document.getElementById('prev-month').addEventListener('click', function() {
                    // Lógica para mes anterior (simulada)
                    alert('Funcionalidad de cambio de mes será implementada en la versión completa');
                });
                
                document.getElementById('next-month').addEventListener('click', function() {
                    // Lógica para mes siguiente (simulada)
                    alert('Funcionalidad de cambio de mes será implementada en la versión completa');
                });
            }
            
            // Generar calendario (simplificado para la demo)
            function generateCalendar(month, year) {
                const calendarDates = document.getElementById('calendar-dates');
                calendarDates.innerHTML = '';

                // Obtener primer día del mes (0=Domingo, 1=Lunes, ...)
                let firstDay = new Date(year, month, 1).getDay();
                // Ajustar para que el calendario inicie en lunes
                firstDay = (firstDay === 0) ? 6 : firstDay - 1;

                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();
                const isCurrentMonth = (month === today.getMonth() && year === today.getFullYear());

                // Crear espacios vacíos para los días anteriores al primer día del mes
                for (let i = 0; i < firstDay; i++) {
                    const emptyDate = document.createElement('div');
                    emptyDate.classList.add('calendar-date', 'disabled');
                    calendarDates.appendChild(emptyDate);
                }

                // Crear elementos para cada día del mes
                for (let i = 1; i <= daysInMonth; i++) {
                    const dateElement = document.createElement('div');
                    dateElement.classList.add('calendar-date');
                    dateElement.textContent = i;

                    // Deshabilitar días pasados si es el mes actual
                    if (isCurrentMonth && i < today.getDate()) {
                        dateElement.classList.add('disabled');
                    } else {
                        dateElement.addEventListener('click', function() {
                            document.querySelectorAll('.calendar-date.selected').forEach(el => el.classList.remove('selected'));
                            this.classList.add('selected');
                            selectedDate = `${i}/${month + 1}/${year}`;
                            updateAvailability();
                        });
                    }

                    // Marcar el día actual por defecto solo si es hoy
                    if (isCurrentMonth && i === today.getDate()) {
                        dateElement.classList.add('selected');
                        selectedDate = `${i}/${month + 1}/${year}`;
                    }

                    calendarDates.appendChild(dateElement);
                }
            }
            
            // Paso 2: Selección de turno
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.addEventListener('click', function() {
                    if (this.classList.contains('disabled')) return;
                    
                    // Quitar selección anterior
                    document.querySelectorAll('.time-slot.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Seleccionar nuevo turno
                    this.classList.add('selected');
                    selectedTime = this.getAttribute('data-time');
                });
            });
            
            // Paso 3: Formulario
            document.getElementById('reservation-form').addEventListener('submit', function(e) {
                e.preventDefault();

                if (!selectedDate) {
                    alert('Por favor selecciona una fecha');
                    goToStep(1);
                    return;
                }

                if (!selectedTime) {
                    alert('Por favor selecciona un turno');
                    goToStep(2);
                    return;
                }

                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const visitors = document.getElementById('visitors').value;
                const stayHours = parseInt(document.getElementById('stay-hours').value);

                // Validar horario según turno
                let turnoInicio, turnoFin;
                if (selectedTime === 'morning') {
                    turnoInicio = 8;
                    turnoFin = 12;
                } else {
                    turnoInicio = 13;
                    turnoFin = 17;
                }
                if (stayHours > (turnoFin - turnoInicio)) {
                    alert(`El máximo de horas para este turno es ${turnoFin - turnoInicio}.`);
                    return;
                }

                // Simular reserva exitosa
                simulateReservation(name, email, visitors, stayHours);
            });
            
            // Paso 4: Confirmación
            function simulateReservation(name, email, visitors, stayHours) {
                // Generar código de reserva aleatorio
                const reservationCode = 'BL-' + Math.floor(100000 + Math.random() * 900000);

                // Actualizar información de confirmación
                document.getElementById('conf-date').textContent = selectedDate;
                document.getElementById('conf-time').textContent = selectedTime === 'morning' ? 'Turno Mañana (8:00 AM - 12:00 PM)' : 'Turno Tarde (1:00 PM - 5:00 PM)';
                document.getElementById('conf-visitors').textContent = visitors;
                document.getElementById('conf-hours').textContent = stayHours + (stayHours === 1 ? ' hora' : ' horas');
                document.getElementById('conf-code').textContent = reservationCode;

                // Mostrar QR ficticio
                const qrDiv = document.getElementById('qrcode');
                qrDiv.innerHTML = `
                    <div style="width:150px;height:150px;background:repeating-linear-gradient(45deg,#222 0 10px,#fff 10px 20px);display:flex;align-items:center;justify-content:center;border-radius:10px;box-shadow:0 2px 8px #0002;">
                        <span style="color:#fff;font-size:2rem;font-weight:bold;text-shadow:1px 1px 4px #0008;">QR</span>
                    </div>
                `;

                // Mostrar confirmación
                document.getElementById('confirmation').style.display = 'block';
                goToStep(4);

                // Actualizar disponibilidad
                if (selectedTime === 'morning') {
                    morningSlots -= parseInt(visitors);
                    document.getElementById('morning-slots').textContent = morningSlots;
                } else {
                    afternoonSlots -= parseInt(visitors);
                    document.getElementById('afternoon-slots').textContent = afternoonSlots;
                }
                updateAvailability();
            }
            
            // Disponibilidad
            function updateAvailability() {
                // Simular disponibilidad aleatoria para la demo
                morningSlots = Math.floor(Math.random() * 450);
                afternoonSlots = Math.floor(Math.random() * 450);
                
                document.getElementById('morning-slots').textContent = morningSlots;
                document.getElementById('afternoon-slots').textContent = afternoonSlots;
                
                // Actualizar indicador de disponibilidad
                const availabilityEl = document.querySelector('.availability');
                const totalSlots = morningSlots + afternoonSlots;
                
                if (totalSlots > 600) {
                    availabilityEl.className = 'availability high';
                    availabilityEl.innerHTML = '<i class="fas fa-check-circle"></i> Disponibilidad alta: Más de 300 cupos disponibles';
                } else if (totalSlots > 300) {
                    availabilityEl.className = 'availability medium';
                    availabilityEl.innerHTML = '<i class="fas fa-info-circle"></i> Disponibilidad media: Entre 150 y 300 cupos disponibles';
                } else {
                    availabilityEl.className = 'availability low';
                    availabilityEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> Disponibilidad baja: Menos de 150 cupos disponibles';
                }
                
                // Deshabilitar turnos sin disponibilidad
                document.querySelectorAll('.time-slot').forEach(slot => {
                    const time = slot.getAttribute('data-time');
                    if ((time === 'morning' && morningSlots === 0) || (time === 'afternoon' && afternoonSlots === 0)) {
                        slot.classList.add('disabled');
                    } else {
                        slot.classList.remove('disabled');
                    }
                });
            }
            
            // Inicializar
            initCalendar();
            updateAvailability();
            goToStep(1);
        });

        // Botón para descargar PDF
        document.addEventListener('click', async function(e) {
            if (e.target && e.target.id === 'download-pdf') {
                // Obtener datos de la reserva
                const fecha = document.getElementById('conf-date').textContent;
                const turno = document.getElementById('conf-time').textContent;
                const visitantes = document.getElementById('conf-visitors').textContent;
                const codigo = document.getElementById('conf-code').textContent;
                const horas = document.getElementById('conf-hours').textContent;

                // Crear PDF con jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Título
                doc.setFontSize(20);
                doc.setTextColor(44, 110, 73);
                doc.text('Reserva Balandra', 105, 20, { align: 'center' });

                // Información
                doc.setFontSize(12);
                doc.setTextColor(0,0,0);
                doc.text(`Fecha: ${fecha}`, 20, 40);
                doc.text(`Turno: ${turno}`, 20, 50);
                doc.text(`Visitantes: ${visitantes}`, 20, 60);
                doc.text(`Tiempo de estancia: ${horas}`, 20, 70);
                doc.text(`Código de reserva: ${codigo}`, 20, 80);

                // QR ficticio (dibujar un recuadro con "QR" en el centro)
                doc.setDrawColor(44, 110, 73);
                doc.setFillColor(34, 34, 34);
                doc.rect(140, 40, 50, 50, 'F');
                doc.setTextColor(255,255,255);
                doc.setFontSize(24);
                doc.text('QR', 165, 70, { align: 'center', baseline: 'middle' });

                // Nota
                doc.setFontSize(11);
                doc.setTextColor(44, 110, 73);
                doc.text('Presenta este código QR en la entrada del parque.', 20, 105);

                // Descargar
                doc.save(`Reserva_Balandra_${codigo}.pdf`);
            }
        });
    </script>
</body>
</html>
